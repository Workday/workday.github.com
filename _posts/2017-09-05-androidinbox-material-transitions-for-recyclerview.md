---
layout: post
title: "Android‚Ää‚Äî‚ÄäInbox Material Transitions for RecyclerView"
description: ""
category: "ui"
tags: [android, ui, transitions]
---
{% include JB/setup %}
_by Jim Hu, Workday San Francisco_

Fragment transitions with RecyclerView items ‚Äúsliding apart‚Äù or ‚ÄúSplit‚Äù

<div style="margin:auto ; width:50%">
<img title="Transition" src="/assets/android/transition.gif"
  height="360" width="640"/>
</div>
<br/>
We wanted to animate an inbox-like feature‚Äôs transition from **List** to
**Details** with  Material transitions that follows the Material Design
guidelines stated
[here](https://material.io/guidelines/motion/material-motion.html#material-motion-implications-of-motion).

<!--more-->

The example provided by the guideline is Google‚Äôs Android Inbox App, it has the
following characteristics:

* The selected inbox item and all above it slide out from the *top*.
* All items under the selected slides out from the *bottom*.
* Detail page slides up uniformly from the *bottom*
* Loading should start immediately after click *and* as soon as transition starts

**We will focus on the ‚ÄúSliding‚Äù for now**

Note: Some examples are in Kotlin

*****

## Transition terms

The transition terms are confusing at first glance, using our example, here‚Äôs
the 4 transition in layman‚Äôs terms, in their actual **triggered order**:

### Opening an item from the List:

* ExitTransition ‚Äî **List‚Äôs** transition for **List‚ÜíDetail**
* EnterTransition ‚Äî **Detail‚Äôs** transition for **List ‚Üí Detail**

### Clicking back or returning from Detail to List:

* ReturnTransition ‚Äî **Detail‚Äôs** transition for **Detail ‚Üí List**
* ReenterTransition ‚Äî **List‚Äôs** transition for **Detail ‚Üí List**

*Reverse animations are also autogenerated for the target‚Äôs **reverse** action
(can be overridden by setting them yourselves), i.e.

* Setting List‚Äôs ExitTransition will autogenerate it‚Äôs ReenterTransition
* Setting Detail‚Äôs EnterTransition will autogenerate it‚Äôs ReturnTransition

### In code it‚Äôll look something like this
~~~ kotlin
detailFragment.enterTransition = Slide()
// If you don't want the Fade on the way back 
detailFragment.returnTransition = null 
listFragment.exitTransition = Explode()
//listFragment.reenterTransition is auto generated reversed
~~~~

*****

## Physical limitations elimination

There‚Äôs a few subtle but important prerequisites that must be set on the
layouts.

RecyclerView:
~~~ xml
<android.support.v7.widget.RecyclerView
    android:layout_width="match_parent"
    android:layout_height="match_parent"
    android:background="@color/white"
    android:transitionGroup="false"
    android:clipChildren="false" />
~~~

ItemView Layout:
~~~ xml
<FrameLayout
    android:layout_width="match_parent"
    android:layout_height="wrap_content"
    android:transitionGroup="true"
    tools:targetApi="lollipop">
~~~

### Breaker of chains ‚Äî Transition Groups

By default all views under a parent/ancestor  with a **background** set (even
transparent ones) will be **automatically deemed a group**. If you need to break
them up like we here with a RecyclerView as the shared-root-white-backgrounded
layout with transparent child Item views. You‚Äôll need to set the layout with the
background to .

But on the other hand, since the Items are ‚Äúbackground-less‚Äù themselves, to
prevent an out-of-body experience you‚Äôll need to do the **opposite** and set  on
the Item layouts for all the child views in that Item to move together.

### Set the children free! ‚Äî Remove parent layout boundaries

Items inside RecyclerViews are limited to animating inside their parent‚Äôs
boundaries, to let the items fly over the AppBar on top, we‚Äôll need to set  on
**all parents/ancestors** up the view hierarchy.

*****

## Crafting the Transition ‚Äî The vertical ‚ÄúSplit‚Äù

Since Android 5.0 there‚Äôs 3 available default visibility transitions available:
[Explode](https://developer.android.com/reference/android/transition/Explode.html), [Fade](https://developer.android.com/reference/android/transition/Fade.html), [Slide](https://developer.android.com/reference/android/transition/Slide.html), but wait, no **Split**?!? üò±

Luckily, if you look closely (in one dimensional vision üëÄ), you‚Äôll realize a
Split is actually just a one dimensional Explode! Setting the Explode
transition‚Äôs epic-center to an horizontal line right under the selected item
will let the view explode vertically.
~~~ kotlin
private fun getListFragmentExitTransition(itemView: View): Transition {
      val epicCenterRect = Rect()
      //itemView is the full-width inbox item's view
      itemView.getGlobalVisibleRect(epicCenterRect)
      // Set Epic center to a imaginary horizontal full width line under the clicked item, so the explosion happens vertically away from it
      epicCenterRect.top = epicCenterRect.bottom
      val exitTransition = Explode()
      exitTransition.epicenterCallback = object : Transition.EpicenterCallback() {
          override fun onGetEpicenter(transition: Transition): Rect {
              return epicCenterRect
          }
      }
}
~~~
and Voil√†!

<div style="margin:auto ; width:50%">
<img title="Transition" src="/assets/android/transition2.gif"
  height="360" width="640"/>
</div>
<br/>

But the items are not *sliding* away, but still *exploding *i.e. Items not
flying together. Nobody‚Äôs inbox should explode (at least not visually..)

### Propagation

The *explode* effect is actually achieved by **propagation**, which delays view
animation according to the view‚Äôs distance from the epic-center, i.e. start
later if the item‚Äôs closer to the epic-center. As we want to just *Slide*, we
disable Propagation by: 

And~~ now we have the **Slide**! So smooth~

<div style="margin:auto ; width:50%">
<img title="Transition" src="/assets/android/transition3.gif"
  height="360" width="640"/>
</div>
<br/>

*****

## Additional stuff ‚Äî Adding FadeOut

You may have probably noticed that we also incorporated ‚ÄúFade Out‚Äù into the
transition. Ideally one could just utilize
[TransitionSet](https://developer.android.com/reference/android/transition/TransitionSet.html)s
and stuff them together to your heart‚Äôs content. But due to a
[bug](https://issuetracker.google.com/issues/37118689), Fragment Exit/Reenter
transitions to not work with TransitionSets (Enter/Return works). Hence for
whoever that has this problem, we could just inherit the Transition and
manipulate the underlying AnimationSet, the following is the full inherited
class:

Note: **onAppear** is for Enter/Reenter, **onDisappear** is for Exit/Return

~~~ kotlin
@TargetApi(Build.VERSION_CODES.LOLLIPOP)
class ExplodeFadeOut : Explode() {
    init {
        propagation = null
    }

    override fun onAppear(sceneRoot: ViewGroup?, view: View?, startValues: TransitionValues?,
                          endValues: TransitionValues?): Animator {
        val explodeAnimator = super.onAppear(sceneRoot, view, startValues, endValues)
        val fadeInAnimator = ObjectAnimator.ofFloat(view, View.ALPHA, 0f, 1f)

        return animatorSet(explodeAnimator, fadeInAnimator)
    }

    override fun onDisappear(sceneRoot: ViewGroup?, view: View?, startValues: TransitionValues?,
                             endValues: TransitionValues?): Animator {
        val explodeAnimator = super.onDisappear(sceneRoot, view, startValues, endValues)
        val fadeOutAnimator = ObjectAnimator.ofFloat(view, View.ALPHA, 1f, 0f)

        return animatorSet(explodeAnimator, fadeOutAnimator)
    }

    private fun animatorSet(explodeAnimator: Animator, fadeAnimator: Animator): AnimatorSet {
        val animatorSet = AnimatorSet()
        animatorSet.play(explodeAnimator).with(fadeAnimator)
        return animatorSet
    }
}
~~~ 
